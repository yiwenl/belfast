import t from"events";
/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var e=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable;function r(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}var n=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},i=0;i<10;i++)e["_"+String.fromCharCode(i)]=i;if("0123456789"!==Object.getOwnPropertyNames(e).map((function(t){return e[t]})).join(""))return!1;var s={};return"abcdefghijklmnopqrst".split("").forEach((function(t){s[t]=t})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},s)).join("")}catch(t){return!1}}()?Object.assign:function(t,n){for(var _,o,a=r(t),h=1;h<arguments.length;h++){for(var E in _=Object(arguments[h]))i.call(_,E)&&(a[E]=_[E]);if(e){o=e(_);for(var u=0;u<o.length;u++)s.call(_,o[u])&&(a[o[u]]=_[o[u]])}}return a},_="undefined"!=typeof Float32Array?Float32Array:Array;function o(t,e){return Math.abs(t-e)<=1e-6*Math.max(1,Math.abs(t),Math.abs(e))}function a(){var t=new _(9);return _!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function h(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function E(t,e){if(t===e){var i=e[1],s=e[2],r=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=s,t[7]=r}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function u(t,e){var i=e[0],s=e[1],r=e[2],n=e[3],_=e[4],o=e[5],a=e[6],h=e[7],E=e[8],u=E*_-o*h,T=-E*n+o*a,c=h*n-_*a,R=i*u+s*T+r*c;return R?(R=1/R,t[0]=u*R,t[1]=(-E*s+r*h)*R,t[2]=(o*s-r*_)*R,t[3]=T*R,t[4]=(E*i-r*a)*R,t[5]=(-o*i+r*n)*R,t[6]=c*R,t[7]=(-h*i+s*a)*R,t[8]=(_*i-s*n)*R,t):null}function T(){var t=new _(16);return _!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function c(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function R(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function l(t,e){var i=e[0],s=e[1],r=e[2],n=e[3],_=e[4],o=e[5],a=e[6],h=e[7],E=e[8],u=e[9],T=e[10],c=e[11],R=e[12],l=e[13],A=e[14],f=e[15],p=i*o-s*_,d=i*a-r*_,I=i*h-n*_,N=s*a-r*o,m=s*h-n*o,S=r*h-n*a,L=E*l-u*R,M=E*A-T*R,O=E*f-c*R,C=u*A-T*l,U=u*f-c*l,g=T*f-c*A,F=p*g-d*U+I*C+N*O-m*M+S*L;return F?(F=1/F,t[0]=(o*g-a*U+h*C)*F,t[1]=(r*U-s*g-n*C)*F,t[2]=(l*S-A*m+f*N)*F,t[3]=(T*m-u*S-c*N)*F,t[4]=(a*O-_*g-h*M)*F,t[5]=(i*g-r*O+n*M)*F,t[6]=(A*I-R*S-f*d)*F,t[7]=(E*S-T*I+c*d)*F,t[8]=(_*U-o*O+h*L)*F,t[9]=(s*O-i*U-n*L)*F,t[10]=(R*m-l*I+f*p)*F,t[11]=(u*I-E*m-c*p)*F,t[12]=(o*M-_*C-a*L)*F,t[13]=(i*C-s*M+r*L)*F,t[14]=(l*d-R*N-A*p)*F,t[15]=(E*N-u*d+T*p)*F,t):null}function A(t,e,i){var s=e[0],r=e[1],n=e[2],_=e[3],o=e[4],a=e[5],h=e[6],E=e[7],u=e[8],T=e[9],c=e[10],R=e[11],l=e[12],A=e[13],f=e[14],p=e[15],d=i[0],I=i[1],N=i[2],m=i[3];return t[0]=d*s+I*o+N*u+m*l,t[1]=d*r+I*a+N*T+m*A,t[2]=d*n+I*h+N*c+m*f,t[3]=d*_+I*E+N*R+m*p,d=i[4],I=i[5],N=i[6],m=i[7],t[4]=d*s+I*o+N*u+m*l,t[5]=d*r+I*a+N*T+m*A,t[6]=d*n+I*h+N*c+m*f,t[7]=d*_+I*E+N*R+m*p,d=i[8],I=i[9],N=i[10],m=i[11],t[8]=d*s+I*o+N*u+m*l,t[9]=d*r+I*a+N*T+m*A,t[10]=d*n+I*h+N*c+m*f,t[11]=d*_+I*E+N*R+m*p,d=i[12],I=i[13],N=i[14],m=i[15],t[12]=d*s+I*o+N*u+m*l,t[13]=d*r+I*a+N*T+m*A,t[14]=d*n+I*h+N*c+m*f,t[15]=d*_+I*E+N*R+m*p,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var f=A;function p(){var t=new _(3);return _!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function d(t){var e=new _(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function I(t,e,i){var s=new _(3);return s[0]=t,s[1]=e,s[2]=i,s}function N(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function m(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}function S(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function L(t,e){var i=e[0]-t[0],s=e[1]-t[1],r=e[2]-t[2];return i*i+s*s+r*r}function M(t,e){var i=e[0],s=e[1],r=e[2],n=i*i+s*s+r*r;return n>0&&(n=1/Math.sqrt(n)),t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function O(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function C(t,e,i){var s=e[0],r=e[1],n=e[2],_=i[0],o=i[1],a=i[2];return t[0]=r*a-n*o,t[1]=n*_-s*a,t[2]=s*o-r*_,t}function U(t,e,i){var s=e[0],r=e[1],n=e[2],_=i[3]*s+i[7]*r+i[11]*n+i[15];return _=_||1,t[0]=(i[0]*s+i[4]*r+i[8]*n+i[12])/_,t[1]=(i[1]*s+i[5]*r+i[9]*n+i[13])/_,t[2]=(i[2]*s+i[6]*r+i[10]*n+i[14])/_,t}var g,F=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t},P=function(t,e){var i=e[0]-t[0],s=e[1]-t[1],r=e[2]-t[2];return Math.hypot(i,s,r)},v=function(t){var e=t[0],i=t[1],s=t[2];return Math.hypot(e,i,s)};g=p();!function(){var t,e=(t=new _(4),_!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t)}();function B(){var t=new _(4);return _!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function D(t,e,i,s){var r,n,_,o,a,h=e[0],E=e[1],u=e[2],T=e[3],c=i[0],R=i[1],l=i[2],A=i[3];return(n=h*c+E*R+u*l+T*A)<0&&(n=-n,c=-c,R=-R,l=-l,A=-A),1-n>1e-6?(r=Math.acos(n),_=Math.sin(r),o=Math.sin((1-s)*r)/_,a=Math.sin(s*r)/_):(o=1-s,a=s),t[0]=o*h+a*c,t[1]=o*E+a*R,t[2]=o*u+a*l,t[3]=o*T+a*A,t}var x,b,G,X,w,V,y=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},H=function(t,e){var i=e[0],s=e[1],r=e[2],n=e[3],_=i*i+s*s+r*r+n*n;return _>0&&(_=1/Math.sqrt(_)),t[0]=i*_,t[1]=s*_,t[2]=r*_,t[3]=n*_,t};x=p(),b=I(1,0,0),G=I(0,1,0),X=B(),w=B(),V=a();const W=()=>{const t=document.createElement("canvas");return!!(t.getContext("experimental-webgl2")||t.getContext("webgl2"))};function k(t,e){const i=t.getExtension(e);if(!i)return!1;const s=e.split("_")[0],r=new RegExp(s+"$");for(const e in i){if("function"==typeof i[e]){const s=e.replace(r,"");e.substring&&(t[s]=i[e].bind(i))}}return!0}const Y=["EXT_shader_texture_lod","EXT_sRGB","EXT_frag_depth","OES_texture_float","OES_texture_half_float","OES_texture_float_linear","OES_texture_half_float_linear","OES_standard_derivatives","EXT_texture_filter_anisotropic","EXT_color_buffer_half_float","OES_vertex_array_object","WEBGL_depth_texture","ANGLE_instanced_arrays","WEBGL_color_buffer_float","WEBGL_draw_buffers"],j=["EXT_color_buffer_float","EXT_texture_filter_anisotropic"],K=(()=>{let t=!1;return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(t=!0),t})(),Z=(t,e)=>{if("number"==typeof t)return o(t,e);if(t.length!==e.length)return!1;let i=!0;return t.forEach(((t,s)=>{i=o(t,e[s])&&i})),i},Q=t=>{let e,i;return t.touches?(e=t.touches[0].pageX,i=t.touches[0].pageY):(e=t.clientX,i=t.clientY),{x:e,y:i}},q={ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALPHA:6406,ALPHA_BITS:3413,ALWAYS:519,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATTACHED_SHADERS:35717,BACK:1029,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BROWSER_DEFAULT_WEBGL:37444,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_BUFFER_BIT:16384,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,COMPILE_STATUS:35713,COMPRESSED_TEXTURE_FORMATS:34467,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_LOST_WEBGL:37442,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH_ATTACHMENT:36096,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,RED:6403,DEPTH_COMPONENT16:33189,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DONT_CARE:4352,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,FASTEST:4353,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GREATER:516,GREEN_BITS:3411,HALF_FLOAT:36193,HIGH_FLOAT:36338,HIGH_INT:36341,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INT:5124,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE_ALPHA:6410,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_RENDERBUFFER_SIZE:34024,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIRRORED_REPEAT:33648,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NUM_COMPRESSED_TEXTURE_FORMATS:34466,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,RED_BITS:3410,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,REPEAT:10497,REPLACE:7681,RGB:6407,RGB5_A1:32855,RGB565:36194,RGBA:6408,RGBA4:32854,SAMPLER_2D:35678,SAMPLER_CUBE:35680,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SHADER_COMPILER:36346,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_CLEAR_VALUE:2961,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE2:33986,TEXTURE3:33987,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE30:34014,TEXTURE31:34015,TEXTURE_2D:3553,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,UNPACK_ALIGNMENT:3317,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VIEWPORT:2978,ZERO:0,R8:33321},z={0:"NONE",1:"ONE",2:"LINE_LOOP",3:"LINE_STRIP",4:"TRIANGLES",5:"TRIANGLE_STRIP",6:"TRIANGLE_FAN",256:"DEPTH_BUFFER_BIT",512:"NEVER",513:"LESS",514:"EQUAL",515:"LEQUAL",516:"GREATER",517:"NOTEQUAL",518:"GEQUAL",519:"ALWAYS",768:"SRC_COLOR",769:"ONE_MINUS_SRC_COLOR",770:"SRC_ALPHA",771:"ONE_MINUS_SRC_ALPHA",772:"DST_ALPHA",773:"ONE_MINUS_DST_ALPHA",774:"DST_COLOR",775:"ONE_MINUS_DST_COLOR",776:"SRC_ALPHA_SATURATE",1024:"STENCIL_BUFFER_BIT",1028:"FRONT",1029:"BACK",1032:"FRONT_AND_BACK",1280:"INVALID_ENUM",1281:"INVALID_VALUE",1282:"INVALID_OPERATION",1285:"OUT_OF_MEMORY",1286:"INVALID_FRAMEBUFFER_OPERATION",2304:"CW",2305:"CCW",2849:"LINE_WIDTH",2884:"CULL_FACE",2885:"CULL_FACE_MODE",2886:"FRONT_FACE",2928:"DEPTH_RANGE",2929:"DEPTH_TEST",2930:"DEPTH_WRITEMASK",2931:"DEPTH_CLEAR_VALUE",2932:"DEPTH_FUNC",2960:"STENCIL_TEST",2961:"STENCIL_CLEAR_VALUE",2962:"STENCIL_FUNC",2963:"STENCIL_VALUE_MASK",2964:"STENCIL_FAIL",2965:"STENCIL_PASS_DEPTH_FAIL",2966:"STENCIL_PASS_DEPTH_PASS",2967:"STENCIL_REF",2968:"STENCIL_WRITEMASK",2978:"VIEWPORT",3024:"DITHER",3042:"BLEND",3088:"SCISSOR_BOX",3089:"SCISSOR_TEST",3106:"COLOR_CLEAR_VALUE",3107:"COLOR_WRITEMASK",3317:"UNPACK_ALIGNMENT",3333:"PACK_ALIGNMENT",3379:"MAX_TEXTURE_SIZE",3386:"MAX_VIEWPORT_DIMS",3408:"SUBPIXEL_BITS",3410:"RED_BITS",3411:"GREEN_BITS",3412:"BLUE_BITS",3413:"ALPHA_BITS",3414:"DEPTH_BITS",3415:"STENCIL_BITS",3553:"TEXTURE_2D",4352:"DONT_CARE",4353:"FASTEST",4354:"NICEST",5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5124:"INT",5125:"UNSIGNED_INT",5126:"FLOAT",5386:"INVERT",5890:"TEXTURE",6401:"STENCIL_INDEX",6402:"DEPTH_COMPONENT",6403:"RED",6406:"ALPHA",6407:"RGB",6408:"RGBA",6409:"LUMINANCE",6410:"LUMINANCE_ALPHA",7680:"KEEP",7681:"REPLACE",7682:"INCR",7683:"DECR",7936:"VENDOR",7937:"RENDERER",7938:"VERSION",9728:"NEAREST",9729:"LINEAR",9984:"NEAREST_MIPMAP_NEAREST",9985:"LINEAR_MIPMAP_NEAREST",9986:"NEAREST_MIPMAP_LINEAR",9987:"LINEAR_MIPMAP_LINEAR",10240:"TEXTURE_MAG_FILTER",10241:"TEXTURE_MIN_FILTER",10242:"TEXTURE_WRAP_S",10243:"TEXTURE_WRAP_T",10497:"REPEAT",10752:"POLYGON_OFFSET_UNITS",16384:"COLOR_BUFFER_BIT",32769:"CONSTANT_COLOR",32770:"ONE_MINUS_CONSTANT_COLOR",32771:"CONSTANT_ALPHA",32772:"ONE_MINUS_CONSTANT_ALPHA",32773:"BLEND_COLOR",32774:"FUNC_ADD",32777:"BLEND_EQUATION_RGB",32778:"FUNC_SUBTRACT",32779:"FUNC_REVERSE_SUBTRACT",32819:"UNSIGNED_SHORT_4_4_4_4",32820:"UNSIGNED_SHORT_5_5_5_1",32823:"POLYGON_OFFSET_FILL",32824:"POLYGON_OFFSET_FACTOR",32854:"RGBA4",32855:"RGB5_A1",32873:"TEXTURE_BINDING_2D",32926:"SAMPLE_ALPHA_TO_COVERAGE",32928:"SAMPLE_COVERAGE",32936:"SAMPLE_BUFFERS",32937:"SAMPLES",32938:"SAMPLE_COVERAGE_VALUE",32939:"SAMPLE_COVERAGE_INVERT",32968:"BLEND_DST_RGB",32969:"BLEND_SRC_RGB",32970:"BLEND_DST_ALPHA",32971:"BLEND_SRC_ALPHA",33071:"CLAMP_TO_EDGE",33170:"GENERATE_MIPMAP_HINT",33189:"DEPTH_COMPONENT16",33306:"DEPTH_STENCIL_ATTACHMENT",33321:"R8",33635:"UNSIGNED_SHORT_5_6_5",33648:"MIRRORED_REPEAT",33901:"ALIASED_POINT_SIZE_RANGE",33902:"ALIASED_LINE_WIDTH_RANGE",33984:"TEXTURE0",33985:"TEXTURE1",33986:"TEXTURE2",33987:"TEXTURE3",33988:"TEXTURE4",33989:"TEXTURE5",33990:"TEXTURE6",33991:"TEXTURE7",33992:"TEXTURE8",33993:"TEXTURE9",33994:"TEXTURE10",33995:"TEXTURE11",33996:"TEXTURE12",33997:"TEXTURE13",33998:"TEXTURE14",33999:"TEXTURE15",34e3:"TEXTURE16",34001:"TEXTURE17",34002:"TEXTURE18",34003:"TEXTURE19",34004:"TEXTURE20",34005:"TEXTURE21",34006:"TEXTURE22",34007:"TEXTURE23",34008:"TEXTURE24",34009:"TEXTURE25",34010:"TEXTURE26",34011:"TEXTURE27",34012:"TEXTURE28",34013:"TEXTURE29",34014:"TEXTURE30",34015:"TEXTURE31",34016:"ACTIVE_TEXTURE",34024:"MAX_RENDERBUFFER_SIZE",34041:"DEPTH_STENCIL",34055:"INCR_WRAP",34056:"DECR_WRAP",34067:"TEXTURE_CUBE_MAP",34068:"TEXTURE_BINDING_CUBE_MAP",34069:"TEXTURE_CUBE_MAP_POSITIVE_X",34070:"TEXTURE_CUBE_MAP_NEGATIVE_X",34071:"TEXTURE_CUBE_MAP_POSITIVE_Y",34072:"TEXTURE_CUBE_MAP_NEGATIVE_Y",34073:"TEXTURE_CUBE_MAP_POSITIVE_Z",34074:"TEXTURE_CUBE_MAP_NEGATIVE_Z",34076:"MAX_CUBE_MAP_TEXTURE_SIZE",34338:"VERTEX_ATTRIB_ARRAY_ENABLED",34339:"VERTEX_ATTRIB_ARRAY_SIZE",34340:"VERTEX_ATTRIB_ARRAY_STRIDE",34341:"VERTEX_ATTRIB_ARRAY_TYPE",34342:"CURRENT_VERTEX_ATTRIB",34373:"VERTEX_ATTRIB_ARRAY_POINTER",34466:"NUM_COMPRESSED_TEXTURE_FORMATS",34467:"COMPRESSED_TEXTURE_FORMATS",34660:"BUFFER_SIZE",34661:"BUFFER_USAGE",34816:"STENCIL_BACK_FUNC",34817:"STENCIL_BACK_FAIL",34818:"STENCIL_BACK_PASS_DEPTH_FAIL",34819:"STENCIL_BACK_PASS_DEPTH_PASS",34877:"BLEND_EQUATION_ALPHA",34921:"MAX_VERTEX_ATTRIBS",34922:"VERTEX_ATTRIB_ARRAY_NORMALIZED",34930:"MAX_TEXTURE_IMAGE_UNITS",34962:"ARRAY_BUFFER",34963:"ELEMENT_ARRAY_BUFFER",34964:"ARRAY_BUFFER_BINDING",34965:"ELEMENT_ARRAY_BUFFER_BINDING",34975:"VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",35040:"STREAM_DRAW",35044:"STATIC_DRAW",35048:"DYNAMIC_DRAW",35632:"FRAGMENT_SHADER",35633:"VERTEX_SHADER",35660:"MAX_VERTEX_TEXTURE_IMAGE_UNITS",35661:"MAX_COMBINED_TEXTURE_IMAGE_UNITS",35663:"SHADER_TYPE",35664:"FLOAT_VEC2",35665:"FLOAT_VEC3",35666:"FLOAT_VEC4",35667:"INT_VEC2",35668:"INT_VEC3",35669:"INT_VEC4",35670:"BOOL",35671:"BOOL_VEC2",35672:"BOOL_VEC3",35673:"BOOL_VEC4",35674:"FLOAT_MAT2",35675:"FLOAT_MAT3",35676:"FLOAT_MAT4",35678:"SAMPLER_2D",35680:"SAMPLER_CUBE",35712:"DELETE_STATUS",35713:"COMPILE_STATUS",35714:"LINK_STATUS",35715:"VALIDATE_STATUS",35716:"INFO_LOG_LENGTH",35717:"ATTACHED_SHADERS",35718:"ACTIVE_UNIFORMS",35719:"ACTIVE_UNIFORM_MAX_LENGTH",35720:"SHADER_SOURCE_LENGTH",35721:"ACTIVE_ATTRIBUTES",35722:"ACTIVE_ATTRIBUTE_MAX_LENGTH",35724:"SHADING_LANGUAGE_VERSION",35725:"CURRENT_PROGRAM",36003:"STENCIL_BACK_REF",36004:"STENCIL_BACK_VALUE_MASK",36005:"STENCIL_BACK_WRITEMASK",36006:"FRAMEBUFFER_BINDING",36007:"RENDERBUFFER_BINDING",36048:"FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",36049:"FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",36050:"FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",36051:"FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",36053:"FRAMEBUFFER_COMPLETE",36054:"FRAMEBUFFER_INCOMPLETE_ATTACHMENT",36055:"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",36057:"FRAMEBUFFER_INCOMPLETE_DIMENSIONS",36061:"FRAMEBUFFER_UNSUPPORTED",36064:"COLOR_ATTACHMENT0",36096:"DEPTH_ATTACHMENT",36128:"STENCIL_ATTACHMENT",36160:"FRAMEBUFFER",36161:"RENDERBUFFER",36162:"RENDERBUFFER_WIDTH",36163:"RENDERBUFFER_HEIGHT",36164:"RENDERBUFFER_INTERNAL_FORMAT",36168:"STENCIL_INDEX8",36176:"RENDERBUFFER_RED_SIZE",36177:"RENDERBUFFER_GREEN_SIZE",36178:"RENDERBUFFER_BLUE_SIZE",36179:"RENDERBUFFER_ALPHA_SIZE",36180:"RENDERBUFFER_DEPTH_SIZE",36181:"RENDERBUFFER_STENCIL_SIZE",36193:"HALF_FLOAT",36194:"RGB565",36336:"LOW_FLOAT",36337:"MEDIUM_FLOAT",36338:"HIGH_FLOAT",36339:"LOW_INT",36340:"MEDIUM_INT",36341:"HIGH_INT",36346:"SHADER_COMPILER",36347:"MAX_VERTEX_UNIFORM_VECTORS",36348:"MAX_VARYING_VECTORS",36349:"MAX_FRAGMENT_UNIFORM_VECTORS",37440:"UNPACK_FLIP_Y_WEBGL",37441:"UNPACK_PREMULTIPLY_ALPHA_WEBGL",37442:"CONTEXT_LOST_WEBGL",37443:"UNPACK_COLORSPACE_CONVERSION_WEBGL",37444:"BROWSER_DEFAULT_WEBGL"};var J={alpha:!1,depth:!0,premultipliedAlpha:!1};let $=0;function tt(){let t,e,i=[0,0,0,0],s=0,r=0,_=0,o=W(),R=K;const f=T(),p=T(),d=T(),I=a(),N=T(),m=a();this.id="WebGLContext"+$++,this.canvas,this.gl,this.CONTEXT_LOST="contextLost",this.CONTEXT_RESTORED="contextRestored",this.shaderCount=0,this.bufferCount=0,this.textureCount=0,this.frameBufferCount=0,this.maxAnisotropy=0,this.multiRenderTargetSupport=!1,this.maxMultiRenderTargets=0,this.init=function(t,e={}){const i=n({},J,e);if(void 0!==t){if(t instanceof HTMLCanvasElement){this.canvas=t;let s=o?"webgl2":"webgl";e.webgl1&&(s="webgl",o=!1),this.gl=t.getContext(s,i)}else t instanceof WebGL2RenderingContext?(o=!0,this.gl=t,this.canvas=t.canvas):t instanceof WebGLRenderingContext?(o=!1,this.gl=t,this.canvas=t.canvas):console.error("The source has to be one of the following : Canvas, WebGLRenderingContext or WebGL2RenderingContext");this.canvas.addEventListener("webglcontextlost",L),this.canvas.addEventListener("webglcontextrestored",M),this.extensions=(t=>{const{gl:e}=t,i=e instanceof WebGL2RenderingContext,s={};(i?j:Y).forEach((t=>{s[t]=e.getExtension(t)})),i||(s.OES_vertex_array_object||console.error("OES_vertex_array_object extension is not supported"),k(e,"OES_vertex_array_object"),k(e,"ANGLE_instanced_arrays"),k(e,"WEBGL_draw_buffers"));const r=s.EXT_texture_filter_anisotropic;if(r&&(t.maxAnisotropy=e.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),t.multiRenderTargetSupport=!!t.gl.drawBuffers,t.multiRenderTargetSupport){const i=t.gl.MAX_DRAW_BUFFERS||s.WEBGL_draw_buffers.MAX_DRAW_BUFFERS_WEBGL;t.maxMultiRenderTargets=e.getParameter(i)}return s})(this),(t=>{for(const e in q)t[e]?console.log("already exist : ",e):t[e]=q[e];if(t.webgl2){const e=/^[^a-z]*$/;for(const i in t.gl)e.test(i)&&-1===i.indexOf("FLOAT")&&(t[i]=t.gl[i],q[i]=t.gl[i],z[t[i]]=i)}})(this),this.setSize(this.canvas.width,this.canvas.height),this.enable(this.BLEND),this.enableAlphaBlending(),this.enable(this.DEPTH_TEST),this.enable(this.CULL_FACE),this.cullFace(et.BACK)}else{const t=document.createElement("canvas");this.init(t,i)}},this.clear=function(t=0,e=0,i=0,s=0){const{gl:r}=this;r.clearColor(t,e,i,s),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT)},this.setSize=function(t,e){r=Math.floor(t),_=Math.floor(e),this.canvas.width=r,this.canvas.height=_,s=r/_,this.viewport(0,0,this._width,_)},this.viewport=function(t,e,s,r){Z(i,[t,e,s,r])||(i=[t,e,s,r],this.gl.viewport(t,e,s,r))},this.getViewport=function(){return i},this.getAspectRatio=function(){return s},this.enable=function(t){this.gl.enable(t)},this.disable=function(t){this.gl.disable(t)},this.cullFace=function(t){this.gl.cullFace(t)},this.enableAlphaBlending=function(){const{gl:t}=this;t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA)},this.enableAdditiveBlending=function(){const{gl:t}=this;t.blendFunc(t.ONE,t.ONE)},this.setMatrices=function(t){e=t,this.setModelMatrix(p)},this.setModelMatrix=function(t){c(d,t),void 0!==e&&(A(f,e.viewMatrix,d),h(I,f),u(I,I),E(I,I),h(m,f),u(m,m),l(N,e.viewMatrix))},this.useShader=function(e){t=e,this.shaderProgram=e.shaderProgram,this.gl.useProgram(this.shaderProgram)},this.draw=function(e){if(e.length)return void e.forEach((t=>this.draw(t)));S(),t.updateUniforms(),e.bind(this);const{drawType:i}=e,{gl:s}=this;e.isInstanced?s.drawElementsInstanced(e.drawType,e.numItems,s.UNSIGNED_SHORT,0,e.numInstance):i===s.POINTS?s.drawArrays(i,0,e.vertexSize):s.drawElements(i,e.numItems,s.UNSIGNED_SHORT,0),e.unbind()},this.getCamera=function(){return e},this.destroy=function(t=!0){this.gl.getExtension("WEBGL_lose_context").loseContext(),t&&void 0!==this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas)},this.__defineGetter__("width",(function(){return r})),this.__defineGetter__("height",(function(){return _})),this.__defineGetter__("webgl2",(function(){return o})),this.__defineGetter__("isMobile",(function(){return R}));const S=()=>{void 0!==e&&(t.uniform("uProjectionMatrix","mat4",e.projectionMatrix),t.uniform("uViewMatrix","mat4",e.viewMatrix),t.uniform("uNormalMatrix","mat3",I),t.uniform("uModelViewMatrixInverse","mat3",m)),t.uniform("uModelMatrix","mat4",d)},L=()=>{this.emit(this.CONTEXT_LOST)},M=()=>{this.emit(this.CONTEXT_RESTORED)}}tt.prototype=Object.assign(Object.create(t.prototype),{constructor:tt});const et=new tt,it={float:"uniform1f",vec2:"uniform2fv",vec3:"uniform3fv",vec4:"uniform4fv",int:"uniform1i",ivec2:"uniform2i",ivec3:"uniform3i",ivec4:"uniform4i",mat2:"uniformMatrix2fv",mat3:"uniformMatrix3fv",mat4:"uniformMatrix4fv"},st=t=>"number"==typeof t?t:t.slice?t.slice(0):new Float32Array(t),rt=t=>"object"==typeof t?function(t){return 9===t.length?"mat3":16===t.length?"mat4":"vec"+t.length}(t):"float";function nt(t,e){let i;this.vertexShader=t||"\n#define SHADER_NAME BASIC_VERTEX\nprecision highp float;attribute vec3 aVertexPosition;attribute vec2 aTextureCoord;void main(void){gl_Position=vec4(aVertexPosition,1.0);}",this.fragmentShader=e||"precision highp float;void main(void){gl_FragColor=vec4(1.0);}",this.shaderProgram;let s={};this.bind=function(t){if(void 0===t||void 0===i||t===i){if(i=t||et,!this.shaderProgram){const t=r(this.vertexShader,!0),e=r(this.fragmentShader,!1);n(t,e)}i.useShader(this)}else console.error("this shader has been bind to a different WebGL Rendering Context",i.id)},this.uniform=function(t,e,i){let r,n;void 0===i?(n=rt(e),r=e):(n=e,r=i);const _=it[n];if(s[t]){const e=s[t];Z(e.value,r)||(e.value=st(r),e.changed=!0)}else s[t]={type:n,uniformType:_,value:st(r),changed:!0}},this.updateUniforms=function(){if(!i)return void console.warn("No WebGL Context has been set yet, please call shader.bind() first");const{gl:t}=i;for(let e in s){const i=s[e];if(i.changed){const s=e;i.uniformLoc||(i.uniformLoc=t.getUniformLocation(this.shaderProgram,s));const{uniformLoc:r,uniformType:n,value:_}=i;null!==r&&(-1===n.indexOf("Matrix")?t[n](r,_):t[n](r,!1,_)),i.changed=!1}}},this.destroy=function(){const{gl:t}=i;t.deleteProgram(this.shaderProgram),i.shaderCount--};const r=(t,e)=>{const{gl:s}=i,r=e?i.VERTEX_SHADER:i.FRAGMENT_SHADER,n=s.createShader(r);return s.shaderSource(n,t),s.compileShader(n),s.getShaderParameter(n,s.COMPILE_STATUS)?n:(console.warn("Error in Shader : ",s.getShaderInfoLog(n)),console.log((t=>{const e=t.split("\n");for(let t=0;t<e.length;t++)e[t]=`${t+1}: ${e[t]}`;return e.join("\n")})(t)),null)},n=(t,e)=>{const{gl:s}=i;this.shaderProgram=s.createProgram(),s.attachShader(this.shaderProgram,t),s.attachShader(this.shaderProgram,e),s.deleteShader(t),s.deleteShader(e),s.linkProgram(this.shaderProgram),i.shaderCount++}}function _t(t=q.TRIANGLES){this.drawType=t,this.numItems=0;let e,i,s,r,n,_=[],o=[],a=[],h=!0,E=!1;this.bufferData=function(t,e,i,s=q.STATIC_DRAW,r=!1){let n,_=[];if("number"==typeof t[0]){if(n=t,void 0===i)return console.error("Missing element size for flatten data :",e),this;for(let t=0;t<n.length;t+=i){const e=[];for(let s=0;s<i;s++)e.push(n[t+s]);_.push(e)}}else _=t,n=(t=>{if(t[0]instanceof Float32Array)return t.reduce(((t,e)=>{for(let i=0;i<e.length;i++)t.push(e[i]);return t}),[]);return t.flat()})(t);const o=void 0===i?t[0].length:i;return u(n,t,e,o,s,r)},this.bufferVertex=function(t,e=q.STATIC_DRAW){return this.bufferData(t,"aVertexPosition",3,e)},this.bufferTexCoord=function(t,e=q.STATIC_DRAW){return this.bufferData(t,"aTextureCoord",2,e)},this.bufferNormal=function(t,e=q.STATIC_DRAW){return this.bufferData(t,"aNormal",3,e)},this.bufferIndex=function(t,e=q.STATIC_DRAW){return i=e,s=new Uint16Array(t),this.numItems=s.length,h=!0,this},this.bind=function(t){if(void 0!==t&&void 0!==n&&t!==n)return void console.error("this mesh has been bind to a different WebGL Rendering Context");n=t||GL;const{gl:i}=n;T(),i.bindVertexArray(e),this.vertexSize=this.getSource("aVertexPosition").length},this.unbind=function(){},this.getAttribute=function(t){return _.find((e=>e.name===t))},this.getAttributes=function(){return _},this.getSource=function(t){const e=this.getAttribute(t);return e?e.source:[]},this.generateFaces=function(){let t,e,i,r,n,_;a=[];const{vertices:o}=this;for(let h=0;h<s.length;h+=3){t=s[h],e=s[h+1],i=s[h+2],r=o[t],n=o[e],_=o[i];const E={indices:[t,e,i],vertices:[r,n,_]};a.push(E)}},this.destroy=function(){const{gl:t}=n;_.forEach((e=>{t.deleteBuffer(e.buffer),e.source=[],e.dataArray=[],n.bufferCount--})),r&&(t.deleteBuffer(r),n.bufferCount--),t.deleteVertexArray(e),_=[],s=[],o=[]},this.__defineGetter__("vertices",(function(){return this.getSource("aVertexPosition")})),this.__defineGetter__("coords",(function(){return this.getSource("aTextureCoord")})),this.__defineGetter__("normal",(function(){return this.getSource("aNormal")})),this.__defineGetter__("indices",(function(){return s})),this.__defineGetter__("faces",(function(){return a})),this.__defineGetter__("isInstanced",(function(){return E}));const u=(t,e,i,s,r=q.STATIC_DRAW,n=!1)=>{const a=r;E=n||E;const h=new Float32Array(t),u=this.getAttribute(i);return u?(u.itemSize=s,u.dataArray=h,u.source=e):_.push({name:i,source:e,itemSize:s,usage:a,dataArray:h,isInstanced:n}),o.push(i),this},T=()=>{const{shaderProgram:t,gl:i}=n;0!=o.length&&(e||(e=i.createVertexArray()),i.bindVertexArray(e),_.forEach((e=>{if(-1!==o.indexOf(e.name)){const s=function(t,e){let i;const{gl:s}=e;return void 0!==t.buffer?i=t.buffer:(i=s.createBuffer(),t.buffer=i,e.bufferCount++),i}(e,n);i.bindBuffer(i.ARRAY_BUFFER,s),i.bufferData(i.ARRAY_BUFFER,e.dataArray,e.usage);const r=((t,e,i)=>(void 0===e.cacheAttribLoc&&(e.cacheAttribLoc={}),void 0===e.cacheAttribLoc[i]&&(e.cacheAttribLoc[i]=t.getAttribLocation(e,i)),e.cacheAttribLoc[i]))(i,t,e.name);r>=0&&(i.enableVertexAttribArray(r),i.vertexAttribPointer(r,e.itemSize,i.FLOAT,!1,0,0)),e.attrPosition=r,e.isInstanced&&i.vertexAttribDivisor(r,1)}})),c(),i.bindVertexArray(null),h=!1,o=[])},c=()=>{const{gl:t}=n;h&&(r||(r=t.createBuffer(),n.bufferCount++),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,r),t.bufferData(t.ELEMENT_ARRAY_BUFFER,s,i))}}const ot=t=>0!==t&&!(t&t-1),at=t=>{const{type:e,minFilter:i,magFilter:s}=t;if(e!==q.UNSIGNED_BYTE)return i===q.NEAREST&&s===q.NEAREST||(console.warn("Trying to set min / mag filter to non NEAREST on floating point textures","minFilter: "+z[i],"magFilter: "+z[s]),!1)};class ht{constructor(t){this._value=t}set(t,e=1){this._value=this._value,this._value=0===e?this._value&0<<t:this._value|1<<t}get(t){let e=this._value&1<<t;return e>>=t,1===e}reset(t){this._value=t}get value(){return this._value}}class Et{constructor(t,e={},i=0,s=0){this._source=t,this._isHtmlElement=(t=>t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement)(this._source),(this._isHtmlElement||!t||((t,e)=>{let i=!0;return"Array"===t.constructor.name&&(console.error("Please convert texture source to Unit8Array or Float32Array"),i=!1),void 0===e.type&&"Uint8Array"!==t.constructor.name&&console.error("Using none Unit8Array, pleaes specify type in the texture parameters"),i})(t,e))&&(this._getDimension(t,i,s),this._params=function(t,e,i){if(!t.minFilter){let s=q.LINEAR;e&&e&&ot(e)&&ot(i)&&(s=q.NEAREST_MIPMAP_LINEAR),t.minFilter=s}return t.mipmap=void 0===t.mipmap||t.mipmap,t.magFilter=t.magFilter||q.LINEAR,t.wrapS=t.wrapS||q.CLAMP_TO_EDGE,t.wrapT=t.wrapT||q.CLAMP_TO_EDGE,t.internalFormat=t.internalFormat||q.RGBA,t.format=t.format||q.RGBA,t.premultiplyAlpha=void 0!==t.premultiplyAlpha&&t.premultiplyAlpha,t.level=t.level||0,t.type=t.type||q.UNSIGNED_BYTE,at(t),t}(e,this._width,this._height),this._checkMipmap(),this._parametersState=new ht(0))}bind(t,e){if(void 0!==e&&void 0!==this.GL&&e!==this.GL)return void console.error("this texture has been bind to a different WebGL Rendering Context",this.GL.id,e.id);this.GL=e||et;const{gl:i}=this.GL;this.createTexture(this.GL),i.activeTexture(i.TEXTURE0+t),i.bindTexture(i.TEXTURE_2D,this._texture),this._checkParameters()}createTexture(t){void 0===t||void 0===this.GL||t===this.GL?(this.GL=t||et,this._texture||(((t,e)=>{t.webgl2&&(e.type===q.HALF_FLOAT?(e.type=t.gl.HALF_FLOAT,e.internalFormat=q.RGBA16F):e.type===q.FLOAT&&(e.internalFormat=q.RGBA32F))})(this.GL,this._params),this._uploadTexture())):console.error("this shader has been bind to a different WebGL Rendering Context",this.GL.id)}updateTexture(t){this._source=t,this._uploadTexture()}generateMipmap(){if(!this._generateMipmap)return;const{gl:t}=this.GL;t.bindTexture(t.TEXTURE_2D,this._texture),t.generateMipmap(t.TEXTURE_2D)}destroy(){const{gl:t}=this.GL;t.deleteTexture(this._texture),this.GL.textureCount--}showProperties(){console.log("Dimension :",this._width,this._height);for(const t in this._params)console.log(t,z[this._params[t]]||this._params[t])}_uploadTexture(){const{gl:t}=this.GL;this._texture||(this._texture=t.createTexture(),this.GL.textureCount++),t.bindTexture(t.TEXTURE_2D,this._texture),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),this._isHtmlElement&&!this.GL.webgl2?t.texImage2D(t.TEXTURE_2D,0,this._params.internalFormat,this._params.format,this._params.type,this._source):t.texImage2D(t.TEXTURE_2D,0,this._params.internalFormat,this._width,this._height,0,this._params.format,this._params.type,this._source),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,this._params.magFilter),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,this._params.minFilter),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,this._params.wrapS),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,this._params.wrapT),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this._premultiplyAlpha),this._generateMipmap&&t.generateMipmap(t.TEXTURE_2D)}_checkParameters(){const{gl:t}=this.GL;this._parametersState.value>0&&(this._parametersState.get(0)?t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,this._params.minFilter):this._parametersState.get(1)?t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,this._params.magFilter):this._parametersState.get(2)?t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,this._params.wrapS):t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,this._params.wrapT)),this._parametersState.reset(0)}_getDimension(t,e,i){t?(this._width=t.width||t.videoWidth,this._height=t.height||t.videoWidth,this._width=this._width||e,this._height=this._height||i,this._width&&this._height||(this._width=this._height=Math.sqrt(t.length/4))):(this._width=e,this._height=i)}_checkMipmap(){this._generateMipmap=this._params.mipmap,ot(this._width)&&ot(this._height)||(this._generateMipmap=!1);-1===z[this._params.minFilter].indexOf("MIPMAP")&&(this._generateMipmap=!1)}get texture(){return this._texture}set minFilter(t){this._params.minFilter=t,this._parametersState.set(0,1),at(this._params)}get minFilter(){return this._params.minFilter}set magFilter(t){this._params.magFilter=t,this._parametersState.set(1,1),at(this._params)}get magFilter(){return this._params.magFilter}set wrapS(t){this._params.wrapS=t,this._parametersState.set(2,1)}get wrapS(){return this._params.wrapS}set wrapT(t){this._params.wrapT=t,this._parametersState.set(3,1)}get wrapT(){return this._params.wrapT}get width(){return this._width}get height(){return this._height}}const ut={DRAW_BUFFERS:"This browser doesn't support multi render targets : WEBGL_draw_buffers",FRAMEBUFFER_CONTEXT:"This browser doesn't support multi render targets : WEBGL_draw_buffers",SHADER_CONTEXT:"This browser doesn't support multi render targets : WEBGL_draw_buffers",TEXTURE_CONTEXT:"This browser doesn't support multi render targets : WEBGL_draw_buffers"},Tt=(t,e="")=>{console.error(t,e)};function ct(t,e,i={},s=1){let r,n;const _=t,o=e,a=i,h=s,E=[];let u;this.bind=function(t,e=!0){if(void 0!==t&&void 0!==r&&t!==r)return void Tt(ut.FRAMEBUFFER_CONTEXT,r.id);r=t||et;const{gl:i}=r;h>1&&!r.multiRenderTargetSupport&&Tt(ut.DRAW_BUFFERS,r.id),n||T(),e&&r.viewport(0,0,_,o),i.bindFramebuffer(i.FRAMEBUFFER,n)},this.unbind=function(t=!0){t&&r.viewport(0,0,r.width,r.height);const{gl:e}=r;e.bindFramebuffer(e.FRAMEBUFFER,null),E.forEach((t=>{t.generateMipmap()}))},this.getTexture=function(t=0){return E[t]},this.destroy=function(){const{gl:t}=r;E.forEach((t=>t.destroy())),u.destroy(),t.deleteFramebuffer(n),r.frameBufferCount--};const T=()=>{c();const{gl:t}=r;n=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,n),r.frameBufferCount++;const e=r.webgl2?t.DRAW_FRAMEBUFFER:t.FRAMEBUFFER,i=[];for(let s=0;s<h;s++)t.framebufferTexture2D(e,t.COLOR_ATTACHMENT0+s,t.TEXTURE_2D,E[s].texture,0),i.push(q["COLOR_ATTACHMENT"+s]);r.multiRenderTargetSupport&&t.drawBuffers(i),t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,u.texture,0),t.bindTexture(t.TEXTURE_2D,null),t.bindRenderbuffer(t.RENDERBUFFER,null),t.bindFramebuffer(t.FRAMEBUFFER,null)},c=()=>{for(let t=0;t<h;t++)E.push(R());const{gl:t}=r,e=r.webgl2?t.DEPTH_COMPONENT16:t.DEPTH_COMPONENT;u=R(e,q.UNSIGNED_INT,q.DEPTH_COMPONENT,{minFilter:q.NEAREST,magFilter:q.NEAREST,mipmap:!1})},R=(t,e,i,s={})=>{const n=Object.assign({},a);i||(i=t),n.internalFormat=t||q.RGBA,n.format=i||q.RGBA,n.type=e||n.type,Object.assign(n,s);const h=new Et(null,n,_,o);return h.createTexture(r),h};this.__defineGetter__("texture",(function(){return E[0]})),this.__defineGetter__("depthTexture",(function(){return u})),this.__defineGetter__("width",(function(){return _})),this.__defineGetter__("height",(function(){return o}))}class Rt{constructor(){this._mtxView=T(),this._mtxProj=T(),this._near=0,this._far=0,this._lookDir=p()}lookAt(t,e,i=[0,1,0]){!function(t,e,i,s){var r,n,_,o,a,h,E,u,T,c,l=e[0],A=e[1],f=e[2],p=s[0],d=s[1],I=s[2],N=i[0],m=i[1],S=i[2];Math.abs(l-N)<1e-6&&Math.abs(A-m)<1e-6&&Math.abs(f-S)<1e-6?R(t):(E=l-N,u=A-m,T=f-S,r=d*(T*=c=1/Math.hypot(E,u,T))-I*(u*=c),n=I*(E*=c)-p*T,_=p*u-d*E,(c=Math.hypot(r,n,_))?(r*=c=1/c,n*=c,_*=c):(r=0,n=0,_=0),o=u*_-T*n,a=T*r-E*_,h=E*n-u*r,(c=Math.hypot(o,a,h))?(o*=c=1/c,a*=c,h*=c):(o=0,a=0,h=0),t[0]=r,t[1]=o,t[2]=E,t[3]=0,t[4]=n,t[5]=a,t[6]=u,t[7]=0,t[8]=_,t[9]=h,t[10]=T,t[11]=0,t[12]=-(r*l+n*A+_*f),t[13]=-(o*l+a*A+h*f),t[14]=-(E*l+u*A+T*f),t[15]=1)}(this._mtxView,t,e,i)}setFromViewProjection(t,e){c(this._mtxView,t),c(this._mtxProj,e)}setViewMatrix(t){c(this._mtxView,t)}setProjectionMatrix(t){c(this._mtxProj,t)}_updateMatrices(){}get viewMatrix(){return this._mtxView}get view(){return this._mtxView}get projectionMatrix(){return this._mtxProj}get projection(){return this._mtxProj}get position(){const t=T();return l(t,this._mtxView),[t[12],t[13],t[14]]}get direction(){const t=a();var e,i,s,r,n,_;return h(t,this._mtxView),E(t,t),e=this._lookDir,s=t,r=(i=[0,0,-1])[0],n=i[1],_=i[2],e[0]=r*s[0]+n*s[3]+_*s[6],e[1]=r*s[1]+n*s[4]+_*s[7],e[2]=r*s[2]+n*s[5]+_*s[8],M(this._lookDir,this._lookDir),this._lookDir}set near(t){this._near=t,this._updateMatrices()}get near(){return this._near}set far(t){this._far=t,this._updateMatrices()}get far(){return this._far}}class lt extends Rt{constructor(t,e,i,s,r=.1,n=100){super(),this._left=0,this._right=0,this._top=0,this._bottom=0,this.ortho(t,e,i,s,r,n)}ortho(t,e,i,s,r=.1,n=100){this.left=t,this.right=e,this.top=i,this.bottom=s,function(t,e,i,s,r,n,_){var o=1/(e-i),a=1/(s-r),h=1/(n-_);t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*h,t[11]=0,t[12]=(e+i)*o,t[13]=(r+s)*a,t[14]=(_+n)*h,t[15]=1}(this._mtxProj,t,e,s,i,r,n),this._left=t,this._right=e,this._top=i,this._bottom=s,this._near=r,this._far=n}_updateMatrices(){this.ortho(this._left,this._right,this._top,this._bottom,this._near,this._far)}}function At(t,e){this.origin=t,this.direction=e;const i=p(),s=p(),r=p(),n=p(),_=p(),o=p(),a=p(),h=p();this.at=function(t){return N(n,this.direction),S(n,n,t),m(n,n,this.origin),n},this.lookAt=function(t){F(this.direction,t,this.origin),M(this.origin,this.origin)},this.closestPointToPoint=function(t){const e=p();F(t,this.origin);const i=O(e,this.direction);return i<0?d(this.origin):(N(e,this.direction),S(e,e,i),m(e,e,this.origin),e)},this.distanceToPoint=function(t){return Math.sqrt(this.distanceSqToPoint(t))},this.distanceSqToPoint=function(t){const e=p();F(e,t,this.origin);const i=O(e,this.direction);return i<0?L(this.origin,t):(N(e,this.direction),S(e,e,i),m(e,e,this.origin),L(e,t))},this.intersectsSphere=function(t,e){return this.distanceToPoint(t)<=e},this.intersectSphere=function(t,e){const i=p();F(i,t,this.origin);const s=O(i,this.direction),r=O(i,i)-s*s,n=e*e;if(r>n)return null;const _=Math.sqrt(n-r),o=s-_,a=s+_;return o<0&&a<0?null:o<0?this.at(a):this.at(o)},this.intersectTriangle=function(t,e,n,E=!0){N(i,t),N(s,e),N(r,n),F(_,s,i),F(o,r,i),C(a,_,o);let u,T=O(this.direction,a);if(T>0){if(E)return null;u=1}else{if(!(T<0))return null;u=-1,T=-T}F(h,this.origin,i),C(o,h,o);const c=u*O(this.direction,o);if(c<0)return null;C(_,_,h);const R=u*O(this.direction,_);if(R<0)return null;if(c+R>T)return null;const l=-u*O(h,a);return l<0?null:this.at(l/T)}}class ft extends Rt{constructor(t,e,i,s){super(),this._fov=0,this._ratio=0,this.setPerspective(t,e,i,s)}setPerspective(t,e,i,s){var r,n,_,o,a,h,E;r=this._mtxProj,n=t,_=e,o=i,a=s,E=1/Math.tan(n/2),r[0]=E/_,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=E,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,null!=a&&a!==1/0?(h=1/(o-a),r[10]=(a+o)*h,r[14]=2*a*o*h):(r[10]=-1,r[14]=-2*o),this._near=i,this._far=s,this._fov=t,this._ratio=e}setAspectRatio(t){this._ratio=t,this._updateMatrices()}generateRay(t,e){const i=T(),s=p();return A(i,this._mtxProj,this._mtxView),l(i,i),U(s,t,i),F(s,s,this.position),M(s,s),e?(e.origin=this.position,e.direction=s):e=new At(this.position,s),e}_updateMatrices(){this.setPerspective(this._fov,this._ratio,this._near,this._far)}}class pt{constructor(t){return this._GL=t||et,this._uniforms={},this._uniformTextures=[],this._fbo,this._clearColor={r:0,g:0,b:0,a:0},this}setClearColor(t=0,e=0,i=0,s=0){return this._clearColor.r=t,this._clearColor.g=e,this._clearColor.b=i,this._clearColor.a=s,this}useProgram(t,e){return this._shader=t instanceof nt?t:new nt(t,e),this}setMesh(t){return this._mesh=t,this}createMesh(t){return this._mesh=new _t(t),this}bufferVertex(t){return this._mesh||(this._mesh=new _t),this._mesh.bufferVertex(t),this}bufferTexCoord(t){return this._mesh||(this._mesh=new _t),this._mesh.bufferTexCoord(t),this}bufferNormal(t){return this._mesh||(this._mesh=new _t),this._mesh.bufferNormal(t),this}bufferIndex(t){return this._mesh||(this._mesh=new _t),this._mesh.bufferIndex(t),this}bufferInstance(t,e){return this._mesh?(this._mesh.bufferInstance(t,e),this):(console.warn("Need to create mesh first"),this)}bufferData(t,e){return this._mesh||(this._mesh=new _t),this._mesh.bufferData(t,e),this}uniform(t,e,i){const s=t;let r,n;return void 0===i?(n=rt(e),r=e):(n=e,r=i),this._uniforms[s]={type:n,value:r},this}uniformTexture(t,e,i){return this.bindTexture(t,e,i)}bindTexture(t,e,i){return void 0!==i?this._uniformTextures[i]={name:t,texture:e}:this._uniformTextures.push({name:t,texture:e}),this}bindFrameBuffer(t){return this._fbo=t,this}draw(){if(this._shader){if(this._mesh){if(this._fbo){const{r:t,g:e,b:i,a:s}=this._clearColor;this._fbo.bind(this._GL),this._GL.clear(t,e,i,s)}this._shader.bind(this._GL);for(const t in this._uniforms){const e=this._uniforms[t];this._shader.uniform(t,e.type,e.value)}return this._uniformTextures.forEach(((t,e)=>{void 0!==t&&(this._shader.uniform(t.name,"int",e),t.texture.bind(e,this._GL))})),this._GL.draw(this._mesh),this._fbo&&this._fbo.unbind(),this}console.warn("No Mesh assigned for draw call")}else console.warn("No GLShader assigned for draw call")}get shader(){return this._shader}get framebuffer(){return this._fbo}}class dt extends pt{constructor(t){super(t);const e=this._GL,i=1e3,s=[[-i,0,0],[i,0,0],[0,-i,0],[0,i,0],[0,0,-i],[0,0,i]];this.createMesh(e.LINES).bufferVertex(s).bufferData([[1,0,0],[1,0,0],[0,1,0],[0,1,0],[0,0,1],[0,0,1]],"aColor").bufferIndex([0,1,2,3,4,5]).useProgram("precision highp float;attribute vec3 aVertexPosition;attribute vec3 aColor;uniform mat4 uModelMatrix;uniform mat4 uViewMatrix;uniform mat4 uProjectionMatrix;varying vec3 vColor;void main(void){gl_Position=uProjectionMatrix*uViewMatrix*uModelMatrix*vec4(aVertexPosition,1.0);vColor=aColor;}","precision highp float;varying vec3 vColor;uniform float uOpacity;void main(void){gl_FragColor=vec4(vColor,uOpacity);}"),this.opacity=.75}draw(){this.uniform("uOpacity",this.opacity),super.draw()}}var It="precision highp float;uniform vec3 uColor;uniform float uOpacity;void main(void){gl_FragColor=vec4(uColor,uOpacity);}";class Nt extends pt{constructor(t){super(t);const e=this._GL,i=[],s=[];let r=0;const n=100;let _,o;for(_=-100;_<n;_+=1)for(o=-100;o<n;o+=1)i.push([_,o,0]),s.push(r),r++,i.push([_,0,o]),s.push(r),r++;this.createMesh(e.POINTS).bufferVertex(i).bufferIndex(s).useProgram("#define SHADER_NAME DOTS_PLANE_VERTEX\nprecision highp float;attribute vec3 aVertexPosition;uniform mat4 uModelMatrix;uniform mat4 uViewMatrix;uniform mat4 uProjectionMatrix;uniform vec2 uViewport;uniform float uScale;uniform float uPointScale;const float radius=0.008;void main(void){gl_Position=uProjectionMatrix*uViewMatrix*uModelMatrix*vec4(aVertexPosition*uScale,1.0);float distOffset=uViewport.y*uProjectionMatrix[1][1]*radius/gl_Position.w;gl_PointSize=distOffset*uPointScale;}",It),this.color=[1,1,1],this.opacity=.5,this.pointScale=1,this.scale=1}draw(){const{width:t,height:e}=this._GL;this.uniform("uColor",this.color).uniform("uOpacity",this.opacity).uniform("uScale",this.scale).uniform("uPointScale",this.pointScale).uniform("uViewport",[t,e]),super.draw()}}class mt extends pt{constructor(t){super(t);const e=this._GL;this.createMesh(e.LINES).bufferVertex([[0,0,0],[1,0,0]]).bufferIndex([0,1]).useProgram("precision highp float;attribute vec3 aVertexPosition;uniform mat4 uModelMatrix;uniform mat4 uViewMatrix;uniform mat4 uProjectionMatrix;uniform vec3 uPosA;uniform vec3 uPosB;void main(void){vec3 pos=mix(uPosA,uPosB,aVertexPosition.x);gl_Position=uProjectionMatrix*uViewMatrix*uModelMatrix*vec4(pos,1.0);}",It),this.color=[1,1,1],this.opacity=.75}draw(t,e,i,s){this.uniform("uPosA",t).uniform("uPosB",e).uniform("uOpacity",s||this.opacity).uniform("uColor",i||this.color),super.draw()}}const St={plane:(t,e,i,s="xy")=>{const r=[],n=[],_=[],o=[],a=t/i,h=e/i,E=1/i,u=.5*-t,T=.5*-e;let c=0;for(let t=0;t<i;t++)for(let e=0;e<i;e++){const R=a*t+u,l=h*e+T,A=t/i,f=e/i;"xz"===s?(r.push([R,0,l+h]),r.push([R+a,0,l+h]),r.push([R+a,0,l]),r.push([R,0,l]),n.push([A,1-(f+E)]),n.push([A+E,1-(f+E)]),n.push([A+E,1-f]),n.push([A,1-f]),o.push([0,1,0]),o.push([0,1,0]),o.push([0,1,0]),o.push([0,1,0])):"yz"===s?(r.push([0,l,R]),r.push([0,l,R+a]),r.push([0,l+h,R+a]),r.push([0,l+h,R]),n.push([A,f]),n.push([A+E,f]),n.push([A+E,f+E]),n.push([A,f+E]),o.push([1,0,0]),o.push([1,0,0]),o.push([1,0,0]),o.push([1,0,0])):(r.push([R,l,0]),r.push([R+a,l,0]),r.push([R+a,l+h,0]),r.push([R,l+h,0]),n.push([A,f]),n.push([A+E,f]),n.push([A+E,f+E]),n.push([A,f+E]),o.push([0,0,1]),o.push([0,0,1]),o.push([0,0,1]),o.push([0,0,1])),_.push(4*c+0),_.push(4*c+1),_.push(4*c+2),_.push(4*c+0),_.push(4*c+2),_.push(4*c+3),c++}return(new _t).bufferVertex(r).bufferTexCoord(n).bufferIndex(_).bufferNormal(o)},cube:(t,e,i)=>{const s=t/2,r=(e=e||t)/2,n=(i=i||t)/2,_=[],o=[],a=[],h=[];let E=0;_.push([-s,r,-n]),_.push([s,r,-n]),_.push([s,-r,-n]),_.push([-s,-r,-n]),h.push([0,0,-1]),h.push([0,0,-1]),h.push([0,0,-1]),h.push([0,0,-1]),o.push([0,0]),o.push([1,0]),o.push([1,1]),o.push([0,1]),a.push(4*E+0),a.push(4*E+1),a.push(4*E+2),a.push(4*E+0),a.push(4*E+2),a.push(4*E+3),E++,_.push([s,r,-n]),_.push([s,r,n]),_.push([s,-r,n]),_.push([s,-r,-n]),h.push([1,0,0]),h.push([1,0,0]),h.push([1,0,0]),h.push([1,0,0]),o.push([0,0]),o.push([1,0]),o.push([1,1]),o.push([0,1]),a.push(4*E+0),a.push(4*E+1),a.push(4*E+2),a.push(4*E+0),a.push(4*E+2),a.push(4*E+3),E++,_.push([s,r,n]),_.push([-s,r,n]),_.push([-s,-r,n]),_.push([s,-r,n]),h.push([0,0,1]),h.push([0,0,1]),h.push([0,0,1]),h.push([0,0,1]),o.push([0,0]),o.push([1,0]),o.push([1,1]),o.push([0,1]),a.push(4*E+0),a.push(4*E+1),a.push(4*E+2),a.push(4*E+0),a.push(4*E+2),a.push(4*E+3),E++,_.push([-s,r,n]),_.push([-s,r,-n]),_.push([-s,-r,-n]),_.push([-s,-r,n]),h.push([-1,0,0]),h.push([-1,0,0]),h.push([-1,0,0]),h.push([-1,0,0]),o.push([0,0]),o.push([1,0]),o.push([1,1]),o.push([0,1]),a.push(4*E+0),a.push(4*E+1),a.push(4*E+2),a.push(4*E+0),a.push(4*E+2),a.push(4*E+3),E++,_.push([s,r,-n]),_.push([-s,r,-n]),_.push([-s,r,n]),_.push([s,r,n]),h.push([0,1,0]),h.push([0,1,0]),h.push([0,1,0]),h.push([0,1,0]),o.push([0,0]),o.push([1,0]),o.push([1,1]),o.push([0,1]),a.push(4*E+0),a.push(4*E+1),a.push(4*E+2),a.push(4*E+0),a.push(4*E+2),a.push(4*E+3),E++,_.push([s,-r,n]),_.push([-s,-r,n]),_.push([-s,-r,-n]),_.push([s,-r,-n]),h.push([0,-1,0]),h.push([0,-1,0]),h.push([0,-1,0]),h.push([0,-1,0]),o.push([0,0]),o.push([1,0]),o.push([1,1]),o.push([0,1]),a.push(4*E+0),a.push(4*E+1),a.push(4*E+2),a.push(4*E+0),a.push(4*E+2),a.push(4*E+3);return(new _t).bufferVertex(_).bufferTexCoord(o).bufferIndex(a).bufferNormal(h)},sphere:(t,e,i=!1)=>{const s=[],r=[],n=[],_=[],o=1/e;let a=0;function h(i,s,r=!1){const n=i/e*Math.PI-.5*Math.PI,_=s/e*Math.PI*2,o=r?1:t,a=[];a[1]=Math.sin(n)*o;const h=Math.cos(n)*o;a[0]=Math.cos(_)*h,a[2]=Math.sin(_)*h;const E=1e4;return a[0]=Math.floor(a[0]*E)/E,a[1]=Math.floor(a[1]*E)/E,a[2]=Math.floor(a[2]*E)/E,a}for(let t=0;t<e;t++)for(let i=0;i<e;i++){s.push(h(t,i)),s.push(h(t+1,i)),s.push(h(t+1,i+1)),s.push(h(t,i+1)),_.push(h(t,i,!0)),_.push(h(t+1,i,!0)),_.push(h(t+1,i+1,!0)),_.push(h(t,i+1,!0));const E=i/e,u=t/e;r.push([1-E,u]),r.push([1-E,u+o]),r.push([1-E-o,u+o]),r.push([1-E-o,u]),n.push(4*a+0),n.push(4*a+1),n.push(4*a+2),n.push(4*a+0),n.push(4*a+2),n.push(4*a+3),a++}i&&n.reverse();return(new _t).bufferVertex(s).bufferTexCoord(r).bufferIndex(n).bufferNormal(_)},bigTriangle:()=>(new _t).bufferData([[-1,-1],[-1,4],[4,-1]],"aPosition",2).bufferIndex([2,1,0])};const Lt={simpleColorFrag:It,copyFrag:"\n#define SHADER_NAME SIMPLE_TEXTURE\nprecision highp float;varying vec2 vTextureCoord;uniform sampler2D texture;void main(void){gl_FragColor=texture2D(texture,vTextureCoord);}",bigTriangleVert:"\n#define SHADER_NAME BIG_TRIANGLE_VERTEX\nprecision mediump float;attribute vec2 aPosition;varying vec2 vTextureCoord;void main(void){gl_Position=vec4(aPosition,0.0,1.0);vTextureCoord=aPosition*.5+.5;}",generalVert:"precision highp float;attribute vec3 aVertexPosition;attribute vec2 aTextureCoord;attribute vec3 aNormal;uniform mat4 uModelMatrix;uniform mat4 uViewMatrix;uniform mat4 uProjectionMatrix;uniform vec3 uTranslate;uniform vec3 uScale;uniform vec3 uRotation;varying vec2 vTextureCoord;varying vec3 vNormal;vec2 rotate(vec2 v,float a){float s=sin(a);float c=cos(a);mat2 m=mat2(c,s,-s,c);return m*v;}void main(void){vec3 pos=aVertexPosition*uScale;pos.yz=rotate(pos.yz,uRotation.x);pos.xz=rotate(pos.xz,uRotation.y);pos.xy=rotate(pos.xy,uRotation.z);pos+=uTranslate;gl_Position=uProjectionMatrix*uViewMatrix*uModelMatrix*vec4(pos,1.0);vTextureCoord=aTextureCoord;vNormal=aNormal;}"};class Mt extends pt{constructor(t){super(t),this.setMesh(St.sphere(1,12)).useProgram(Lt.generalVert,Lt.simpleColorFrag).uniform("uRotation",[0,0,0])}draw(t,e=[1,1,1],i=[1,1,1],s=1){this.uniform("uTranslate",t).uniform("uScale",e).uniform("uColor",i).uniform("uOpacity",s),super.draw(0)}}class Ot extends pt{constructor(t){super(t),this.setMesh(St.bigTriangle()).useProgram(Lt.bigTriangleVert,Lt.copyFrag)}draw(t){this.bindTexture("texture",t,0),super.draw(0)}}function Ct(){let t=p(),e=p(),i=I(1,1,1),s=T(),r=T(),n=T(),_=T(),o=T(),a=T(),h=B(),E=[],u=!0;this.update=function(t){void 0!==t&&c(r,t),u=!0,l()},this.addChild=function(t){E.push(t)},this.removeChild=function(t){const e=E.indexOf(t);-1!=e?E.splice(e,1):console.warn("Child no exist")},this.setRotationFromQuaternion=function(t){y(h,t),u=!0};const l=()=>{var T,c,l,A,p,d,I,N,m,S,L,M,O;u&&(R(n),R(o),R(_),T=_,c=_,l=e[0],A=Math.sin(l),p=Math.cos(l),d=c[4],I=c[5],N=c[6],m=c[7],S=c[8],L=c[9],M=c[10],O=c[11],c!==T&&(T[0]=c[0],T[1]=c[1],T[2]=c[2],T[3]=c[3],T[12]=c[12],T[13]=c[13],T[14]=c[14],T[15]=c[15]),T[4]=d*p+S*A,T[5]=I*p+L*A,T[6]=N*p+M*A,T[7]=m*p+O*A,T[8]=S*p-d*A,T[9]=L*p-I*A,T[10]=M*p-N*A,T[11]=O*p-m*A,function(t,e,i){var s=Math.sin(i),r=Math.cos(i),n=e[0],_=e[1],o=e[2],a=e[3],h=e[8],E=e[9],u=e[10],T=e[11];e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*r-h*s,t[1]=_*r-E*s,t[2]=o*r-u*s,t[3]=a*r-T*s,t[8]=n*s+h*r,t[9]=_*s+E*r,t[10]=o*s+u*r,t[11]=a*s+T*r}(_,_,e[1]),function(t,e,i){var s=Math.sin(i),r=Math.cos(i),n=e[0],_=e[1],o=e[2],a=e[3],h=e[4],E=e[5],u=e[6],T=e[7];e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*r+h*s,t[1]=_*r+E*s,t[2]=o*r+u*s,t[3]=a*r+T*s,t[4]=h*r-n*s,t[5]=E*r-_*s,t[6]=u*r-o*s,t[7]=T*r-a*s}(_,_,e[2]),function(t,e){var i=e[0],s=e[1],r=e[2],n=e[3],_=i+i,o=s+s,a=r+r,h=i*_,E=s*_,u=s*o,T=r*_,c=r*o,R=r*a,l=n*_,A=n*o,f=n*a;t[0]=1-u-R,t[1]=E+f,t[2]=T-A,t[3]=0,t[4]=E-f,t[5]=1-h-R,t[6]=c+l,t[7]=0,t[8]=T+A,t[9]=c-l,t[10]=1-h-u,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(a,h),f(_,a,_),function(t,e,i){var s=i[0],r=i[1],n=i[2];t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t[3]=e[3]*s,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]}(o,o,i),function(t,e,i){var s,r,n,_,o,a,h,E,u,T,c,R,l=i[0],A=i[1],f=i[2];e===t?(t[12]=e[0]*l+e[4]*A+e[8]*f+e[12],t[13]=e[1]*l+e[5]*A+e[9]*f+e[13],t[14]=e[2]*l+e[6]*A+e[10]*f+e[14],t[15]=e[3]*l+e[7]*A+e[11]*f+e[15]):(s=e[0],r=e[1],n=e[2],_=e[3],o=e[4],a=e[5],h=e[6],E=e[7],u=e[8],T=e[9],c=e[10],R=e[11],t[0]=s,t[1]=r,t[2]=n,t[3]=_,t[4]=o,t[5]=a,t[6]=h,t[7]=E,t[8]=u,t[9]=T,t[10]=c,t[11]=R,t[12]=s*l+o*A+u*f+e[12],t[13]=r*l+a*A+T*f+e[13],t[14]=n*l+h*A+c*f+e[14],t[15]=_*l+E*A+R*f+e[15])}(n,n,t),f(s,n,_),f(s,s,o),f(s,r,s),E.forEach((t=>{t.update(s)})),u=!1)};this.__defineGetter__("matrix",(function(){return l(),s})),this.__defineSetter__("x",(function(e){t[0]=e,u=!0})),this.__defineGetter__("x",(function(){return t[0]})),this.__defineSetter__("y",(function(e){t[1]=e,u=!0})),this.__defineGetter__("y",(function(){return t[1]})),this.__defineSetter__("z",(function(e){t[2]=e,u=!0})),this.__defineGetter__("z",(function(){return t[2]})),this.__defineSetter__("scaleX",(function(t){i[0]=t,u=!0})),this.__defineGetter__("scaleX",(function(){return i[0]})),this.__defineSetter__("scaleY",(function(t){i[1]=t,u=!0})),this.__defineGetter__("scaleY",(function(){return i[1]})),this.__defineSetter__("scaleZ",(function(t){i[2]=t,u=!0})),this.__defineGetter__("scaleZ",(function(){return i[2]})),this.__defineSetter__("rotationX",(function(t){e[0]=t,u=!0})),this.__defineGetter__("rotationX",(function(){return e[0]})),this.__defineSetter__("rotationY",(function(t){e[1]=t,u=!0})),this.__defineGetter__("rotationY",(function(){return e[1]})),this.__defineSetter__("rotationZ",(function(t){e[2]=t,u=!0})),this.__defineGetter__("rotationZ",(function(){return e[2]})),this.__defineGetter__("children",(function(){return E}))}class Ut{constructor(t,e,i,s={},r=1){this._fbos=[];for(let n=0;n<t;n++){const t=new ct(e,i,s,r);this._fbos.push(t)}}swap(){const t=this._fbos.shift();this._fbos.push(t)}get read(){return this._fbos[this._fbos.length-1]}get write(){return this._fbos[0]}get all(){return this._fbos}}class gt extends Ut{constructor(t,e,i={},s=1){super(2,t,e,i,s)}}const Ft=new class{constructor(){this._delayTasks=[],this._nextTasks=[],this._deferTasks=[],this._highTasks=[],this._usurpTask=[],this._enterframeTasks=[],this._idTable=0,this._startTime=(new Date).getTime(),this._deltaTime=0,this._internalTime=0,this._isPaused=!1,this._loop()}addEF(t,e){e=e||[];const i=this._idTable;return this._enterframeTasks[i]={func:t,params:e},this._idTable++,i}removeEF(t){return void 0!==this._enterframeTasks[t]&&(this._enterframeTasks[t]=null),-1}delay(t,e,i){const s={func:t,params:e,delay:i,time:(new Date).getTime()};this._delayTasks.push(s)}defer(t,e){const i={func:t,params:e};this._deferTasks.push(i)}next(t,e){const i={func:t,params:e};this._nextTasks.push(i)}usurp(t,e){const i={func:t,params:e};this._usurpTask.push(i)}pause(){this._isPaused=!0}advance(){this._internalTime+=1/60}resume(){this._isPaused=!1}_process(){let t,e,i,s=0;for(s=0;s<this._enterframeTasks.length;s++)t=this._enterframeTasks[s],null!=t&&t.func(t.params);for(;this._highTasks.length>0;)t=this._highTasks.pop(),t.func(t.params);let r=(new Date).getTime(),n=this._deltaTime;for(this._deltaTime=(r-this._startTime)/1e3,s=0;s<this._delayTasks.length;s++)t=this._delayTasks[s],r-t.time>t.delay&&(t.func(t.params),this._delayTasks.splice(s,1));for(r=(new Date).getTime(),this._deltaTime=(r-this._startTime)/1e3,e=1e3/60;this._deferTasks.length>0;){if(t=this._deferTasks.shift(),i=(new Date).getTime(),!(i-r<e)){this._deferTasks.unshift(t);break}t.func(t.params)}for(r=(new Date).getTime(),this._deltaTime=(r-this._startTime)/1e3,e=1e3/60;this._usurpTask.length>0;)t=this._usurpTask.shift(),i=(new Date).getTime(),i-r<e&&t.func(t.params);this._highTasks=this._highTasks.concat(this._nextTasks),this._nextTasks=[],this._usurpTask=[],this._isPaused||(this._internalTime+=this._deltaTime-n)}_loop(){this._process(),window.requestAnimationFrame((()=>this._loop()))}get intervalTime(){return this._internalTime}get deltaTime(){return this._deltaTime}};class Pt{constructor(t,e=.1){this.easing=e,this._value=t,this._targetValue=t,this._efIndex=Ft.addEF((()=>this._update()))}_update(){this._checkLimit(),this._value+=(this._targetValue-this._value)*this.easing,Math.abs(this._targetValue-this._value)<1e-4&&(this._value=this._targetValue)}setTo(t){this._targetValue=this._value=t}add(t){this._targetValue+=t}limit(t,e){t>e?this.limit(e,t):(this._min=t,this._max=e,this._checkLimit())}_checkLimit(){void 0!==this._min&&this._targetValue<this._min&&(this._targetValue=this._min),void 0!==this._max&&this._targetValue>this._max&&(this._targetValue=this._max)}destroy(){Ft.removeEF(this._efIndex)}set value(t){this._targetValue=t}get value(){return this._value}get targetValue(){return this._targetValue}}const vt={Linear:{None:t=>t},Quadratic:{In:t=>t*t,Out:t=>t*(2-t),InOut:t=>(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},Cubic:{In:t=>t*t*t,Out:t=>--t*t*t+1,InOut:t=>(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},Quartic:{In:t=>t*t*t*t,Out:t=>1- --t*t*t*t,InOut:t=>(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},Quintic:{In:t=>t*t*t*t*t,Out:t=>--t*t*t*t*t+1,InOut:t=>(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},Sinusoidal:{In:t=>1-Math.cos(t*Math.PI/2),Out:t=>Math.sin(t*Math.PI/2),InOut:t=>.5*(1-Math.cos(Math.PI*t))},Exponential:{In:t=>0===t?0:Math.pow(1024,t-1),Out:t=>1===t?1:1-Math.pow(2,-10*t),InOut:t=>0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))},Circular:{In:t=>1-Math.sqrt(1-t*t),Out:t=>Math.sqrt(1- --t*t),InOut:t=>(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},Elastic:{In(t){let e,i=.1;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=.1):e=.4*Math.asin(1/i)/(2*Math.PI),-i*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/.4))},Out(t){let e,i=.1;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=.1):e=.4*Math.asin(1/i)/(2*Math.PI),i*Math.pow(2,-10*t)*Math.sin((t-e)*(2*Math.PI)/.4)+1)},InOut(t){let e,i=.1;const s=.4;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=.1):e=s*Math.asin(1/i)/(2*Math.PI),(t*=2)<1?i*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/s)*-.5:i*Math.pow(2,-10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/s)*.5+1)}},Back:{In(t){const e=1.70158;return t*t*((e+1)*t-e)},Out(t){const e=1.70158;return--t*t*((e+1)*t+e)+1},InOut(t){const e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{in:t=>1-vt.Bounce.out(1-t),out:t=>t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375,inOut:t=>t<.5?.5*vt.Bounce.in(2*t):.5*vt.Bounce.out(2*t-1)+.5}};class Bt{constructor(t,e="expOut",i=.01){this._value=t,this._startValue=t,this._targetValue=t,this._counter=1,this.speed=i,this.easing=e,this._needUpdate=!0,this._efIndex=Ft.addEF((()=>this._update()))}_update(){let t=this._counter+this.speed;t>1&&(t=1),this._counter!==t?(this._counter=t,this._needUpdate=!0):this._needUpdate=!1}limit(t,e){t>e?this.limit(e,t):(this._min=t,this._max=e,this._checkLimit())}setTo(t){this._value=t,this._targetValue=t,this._counter=1}_checkLimit(){void 0!==this._min&&this._targetValue<this._min&&(this._targetValue=this._min),void 0!==this._max&&this._targetValue>this._max&&(this._targetValue=this._max)}destroy(){Ft.removeEF(this._efIndex)}set value(t){this._startValue=this._value,this._targetValue=t,this._checkLimit(),this._counter=0}get value(){if(this._needUpdate){const t=function(t){switch(t){default:case"linear":return vt.Linear.None;case"expIn":return vt.Exponential.In;case"expOut":return vt.Exponential.Out;case"expInOut":return vt.Exponential.InOut;case"cubicIn":return vt.Cubic.In;case"cubicOut":return vt.Cubic.Out;case"cubicInOut":return vt.Cubic.InOut;case"quarticIn":return vt.Quartic.In;case"quarticOut":return vt.Quartic.Out;case"quarticInOut":return vt.Quartic.InOut;case"quinticIn":return vt.Quintic.In;case"quinticOut":return vt.Quintic.Out;case"quinticInOut":return vt.Quintic.InOut;case"sinusoidalIn":return vt.Sinusoidal.In;case"sinusoidalOut":return vt.Sinusoidal.Out;case"sinusoidalInOut":return vt.Sinusoidal.InOut;case"circularIn":return vt.Circular.In;case"circularOut":return vt.Circular.Out;case"circularInOut":return vt.Circular.InOut;case"elasticIn":return vt.Elastic.In;case"elasticOut":return vt.Elastic.Out;case"elasticInOut":return vt.Elastic.InOut;case"backIn":return vt.Back.In;case"backOut":return vt.Back.Out;case"backInOut":return vt.Back.InOut;case"bounceIn":return vt.Bounce.in;case"bounceOut":return vt.Bounce.out;case"bounceInOut":return vt.Bounce.inOut}}(this.easing)(this._counter);this._value=this._startValue+t*(this._targetValue-this._startValue),this._needUpdate=!1}return this._value}get targetValue(){return this._targetValue}}class Dt{constructor(t,e=.1,i=.9){this._value=t,this._targetValue=t,this.speed=e,this.decreaseRate=i,this._velocity=0,this._efIndex=Ft.addEF((()=>this._update()))}_update(){const t=1e-4;this._checkLimit(),Math.abs(this._targetValue-this._value)<t?this._value=this._targetValue:(this._velocity+=(this._targetValue-this._value)*this.speed,this._value+=this._velocity,this._velocity*=this.decreaseRate,Math.abs(this._targetValue-this._value)<t&&(this._value=this._targetValue))}limit(t,e){t>e?this.limit(e,t):(this._min=t,this._max=e,this._checkLimit())}_checkLimit(){void 0!==this._min&&this._targetValue<this._min&&(this._targetValue=this._min),void 0!==this._max&&this._targetValue>this._max&&(this._targetValue=this._max)}destroy(){Ft.removeEF(this._efIndex)}set value(t){this._targetValue=t}get value(){return this._value}}const xt=function(t,e){const i=e||{};return t.touches?(i.x=t.touches[0].pageX,i.y=t.touches[0].pageY):(i.x=t.clientX,i.y=t.clientY),i};class bt{constructor(t,e=window,i=10){this._target=t,this._listenerTarget=e,this._mouse={},this._preMouse={},this.center=p(),this._up=I(0,1,0),this.radius=new Pt(i),this.position=I(0,0,this.radius.value),this.positionOffset=p(),this._rx=new Pt(0),this._rx.limit(-Math.PI/2,Math.PI/2),this._ry=new Pt(0),this._preRX=0,this._preRY=0,this._isLockZoom=!1,this._isLockRotation=!1,this._isInvert=!1,this.sensitivity=1,this._wheelBind=t=>this._onWheel(t),this._downBind=t=>this._onDown(t),this._moveBind=t=>this._onMove(t),this._upBind=()=>this._onUp(),this.connect(),Ft.addEF((()=>this._loop()))}connect(){this.disconnect(),this._listenerTarget.addEventListener("mousewheel",this._wheelBind),this._listenerTarget.addEventListener("DOMMouseScroll",this._wheelBind),this._listenerTarget.addEventListener("mousedown",this._downBind),this._listenerTarget.addEventListener("touchstart",this._downBind),this._listenerTarget.addEventListener("mousemove",this._moveBind),this._listenerTarget.addEventListener("touchmove",this._moveBind),window.addEventListener("touchend",this._upBind),window.addEventListener("mouseup",this._upBind)}disconnect(){this._listenerTarget.removeEventListener("mousewheel",this._wheelBind),this._listenerTarget.removeEventListener("DOMMouseScroll",this._wheelBind),this._listenerTarget.removeEventListener("mousedown",this._downBind),this._listenerTarget.removeEventListener("touchstart",this._downBind),this._listenerTarget.removeEventListener("mousemove",this._moveBind),this._listenerTarget.removeEventListener("touchmove",this._moveBind),window.removeEventListener("touchend",this._upBind),window.removeEventListener("mouseup",this._upBind)}lock(t=!0){this._isLockZoom=t,this._isLockRotation=t,this._isMouseDown=!1}lockZoom(t=!0){this._isLockZoom=t}lockRotation(t=!0){this._isLockRotation=t}inverseControl(t=!0){this._isInvert=t}_onDown(t){this._isLockRotation||(this._isMouseDown=!0,xt(t,this._mouse),xt(t,this._preMouse),this._preRX=this._rx.targetValue,this._preRY=this._ry.targetValue)}_onMove(t){if(!this._isLockRotation&&(xt(t,this._mouse),t.touches&&t.preventDefault(),this._isMouseDown)){let t=-(this._mouse.x-this._preMouse.x);this._isInvert&&(t*=-1),this._ry.value=this._preRY-.01*t*this.sensitivity;let e=-(this._mouse.y-this._preMouse.y);this._isInvert&&(e*=-1),this._rx.value=this._preRX-.01*e*this.sensitivity}}_onUp(){this._isLockRotation||(this._isMouseDown=!1)}_onWheel(t){if(this._isLockZoom)return;const e=t.wheelDelta,i=t.detail;let s=0;s=i?e?e/i/40*i>0?1:-1:-i/3:e/120,this.radius.add(2*-s),this.radius.targetValue<0&&(this.radius.value=1e-4)}_loop(){this._updatePosition(),this._target&&this._updateCamera()}update(){this._updatePosition()}_updatePosition(){this.position[1]=Math.sin(this._rx.value)*this.radius.value;const t=Math.cos(this._rx.value)*this.radius.value;this.position[0]=Math.cos(this._ry.value+.5*Math.PI)*t,this.position[2]=Math.sin(this._ry.value+.5*Math.PI)*t,m(this.position,this.position,this.positionOffset)}_updateCamera(){this._target.lookAt(this.position,this.center,this._up)}get rx(){return this._rx}get ry(){return this._ry}}class Gt extends t{constructor(t,e,i,s=!1,r=window){super(),this._mesh=t,this._mesh.generateFaces(),this._camera=e,this.faceVertices=t.faces.map((t=>t.vertices)),this.clickTolerance=8,this._ray=new At([0,0,0],[0,0,-1]),this._hit=I(-999,-999,-999),this._lastPos,this._firstPos,this.modelMatrix=T(),this.resolution=i||[window.innerWidth,window.innerHeight],this._listenerTarget=r,this._skippingMove=s,this._onMoveBind=t=>this._onMove(t),this._onDownBind=t=>this._onDown(t),this._onUpBind=()=>this._onUp(),this.connect()}connect(){this._listenerTarget.addEventListener("mousedown",this._onDownBind),this._listenerTarget.addEventListener("mousemove",this._onMoveBind),this._listenerTarget.addEventListener("mouseup",this._onUpBind)}disconnect(){this._listenerTarget.removeEventListener("mousedown",this._onDownBind),this._listenerTarget.removeEventListener("mousemove",this._onMoveBind),this._listenerTarget.removeEventListener("mouseup",this._onUpBind)}_checkHit(t="onHit"){const e=this._camera;if(!e)return;const i=this._lastPos.x/this.resolution[0]*2-1,s=-this._lastPos.y/this.resolution[1]*2+1;let r;e.generateRay([i,s,0],this._ray);const n=p(),_=p(),o=p();let a=0;const h=(t,e)=>{U(e,t,this.modelMatrix)};for(let t=0;t<this.faceVertices.length;t++){const i=this.faceVertices[t];h(i[0],n),h(i[1],_),h(i[2],o);const s=this._ray.intersectTriangle(n,_,o);if(s)if(r){const t=P(s,e.position);t<a&&(r=d(s),a=t)}else r=d(s),a=P(r,e.position)}r?(this._hit=d(r),this.emit(t,{hit:r})):this.emit("onUp")}_onDown(t){this._firstPos=Q(t),this._lastPos=Q(t),this._checkHit("onDown")}_onMove(t){this._lastPos=Q(t),this._skippingMove||this._checkHit()}_onUp(){(function(t,e){const i=t.x-e.x,s=t.y-e.y;return Math.sqrt(i*i+s*s)})(this._firstPos,this._lastPos)<this.clickTolerance&&this._checkHit()}}Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function t(){var e=isNaN(arguments[0])?1:Number(arguments[0]);return e?Array.prototype.reduce.call(this,(function(i,s){return Array.isArray(s)?i.push.apply(i,t.call(s,e-1)):i.push(s),i}),[]):Array.prototype.slice.call(this)},writable:!0});export{ht as BitSwitch,Rt as Camera,lt as CameraOrtho,ft as CameraPerspective,pt as Draw,dt as DrawAxis,Mt as DrawBall,Ot as DrawCopy,Nt as DrawDotsPlane,mt as DrawLine,Pt as EaseNumber,Ut as FboArray,gt as FboPingPong,ct as FrameBuffer,et as GL,nt as GLShader,Et as GLTexture,tt as GLTool,St as Geom,Gt as HitTestor,_t as Mesh,Ct as Object3D,bt as OrbitalControl,At as Ray,Lt as ShaderLibs,Dt as SpringNumber,Bt as TweenNumber,q as WebGLConst,z as WebGLNumber,W as checkWebGL2};
